<div class="container">

    <h1>Overview</h1>

    <h2>Purpose</h2>

    <!-- Additionally, Programmable Video provides the missing pieces required to use WebRTC to build sophisticated applications:
         Global STUN/TURN relays, media services for large-scale group conferences and recording, and signaling infrastructure are all included. -->

    <p>
        <strong>ApiRTC</strong> is built on top <strong>WebRTC</strong>. It helps to fastly build rich media sharing web based applications.
    </p>
    <p><strong>ApiRTC</strong> fills gaps <strong>WebRTC</strong> does not address.</p>
    <p><strong>ApiRTC</strong> brings :</p>
    <ul>
        <li> signalisation,</li>
        <li> STUN/TURN relays,</li>
        <li> large scale group conversations support.</li>
    </ul>

    <!-- <h2>ApiRTC Terms</h2>

    <ul>
        <li>An <strong>enterprise</strong></li>
        <li>a <strong>user</strong></li>
        <li>the <strong>apiKey</strong></li>
    </ul> -->

    <h2>ApiRTC main and concepts and Classes</h2>

    <ul>
        <li>In a <code>Conversation</code>, individuals can <strong>chat</strong>, <strong>watch</strong>,
            <strong>listen</strong> and/or <strong>share</strong>&nbsp;<strong>real-time audio, video, data,
                screen...</strong>
        </li>
        <li>Usually, each instance of client application instanciates one <code>UserAgent</code> representing the local individual.
        </li>
        <li>A <code>Contact</code> represents a peer individual.</li>
        <li>A <code>Stream</code> is audio, and/or video captured with from sources available from browser.</li>
        <li>A <code>Session</code> must be opened with <strong>ApiRTC</strong>'s servers to create a
            <code>Conversation</code> to which individuals can join.
        </li>
    </ul>

    <h1>Getting Started</h1>

    <h2>Load ApiRTC library</h2>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="Angular">
            <br>
            <div class="card">
                <div class="card-body">
                    <p>In your angular project run :</p>
                    <p><code>npm install @apizee/apirtc@latest --save</code></p>
                    <p>And in
                        <code>angular.json</code> add script :
                    </p>
                    <pre>
            <code>
            {{ '{' }}
                ...
                "projects": {{ '{' }}
                    "YOUR_PROJECT_NAME": {{ '{' }}
                        ...
                        "architect": {{ '{' }}
                            "build": {{ '{' }}
                                ...
                                "options": {{ '{' }}
                                    ...
                                    "scripts": [
                                        "node_modules/@apizee/apirtc/apiRTC.min.js"
            </code>
                </pre>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="ReactJS">
            <br>
            <div class="card">
                <div class="card-body">
                    <p>TODO</p>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="JS">
            <br>
            <div class="card">
                <div class="card-body">
                    <p>Just add :
                    </p>
                    <p><code>&lt;script type="text/javascript" src="https://cloud.apizee.com/apiRTC/apiRTC-latest.min.js"&gt;&lt;/script&gt;</code>
                    </p>
                    <!-- <code>&lt;head&gt;...&lt;/head&gt;</code> tags of <code>index.html</code> -->
                    <p>inside <code>&lt;head&gt;...&lt;/head&gt;</code> tag of <code>.html</code> document.</p>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>
    <br>

    <p class="alert alert-info" role="alert">The <strong>ApiRTC</strong> api reference can be found at <a href="https://dev.apirtc.com/api/reference" target="_blank">https://dev.apirtc.com/api/reference</a></p>

    <h2>UserAgent</h2>

    <p>As the entry point to <strong>ApiRTC</strong>, <code>UserAgent</code> is instanciated using the
        <strong>apiKey</strong> associated to your <strong>enterprise</strong> account on <a href="https://www.apirtc.com" target="_blank">https://www.apirtc.com</a>.
    </p>

    <p class="alert alert-info" role="alert">Get your <strong>apiKey</strong> from <a href="https://cloud.apirtc.com/enterprise/api" target="_blank">https://cloud.apirtc.com/enterprise/api</a>
    </p>

    <p class="text-center"><img src="assets/apirtc_useragent.svg" alt="image"></p>

    <pre class="border"><code>
        userAgent = new apiRTC.UserAgent(&#123;uri: 'apzkey:' + apiKey&#125;);
    </code></pre>
    <!-- 
    <p><code>UserAgent</code> permet d'accèder aux fonctionnalités <strong>non-connectées</strong> d'<strong>ApiRTC</strong>.</p>
    <p>TODO : list non-connected features</p>
    <ul><li></li></ul> -->

    <h2>Stream</h2>

    <p>When <code>UserAgent.createStream</code> is called, a popup opens in the browser to request user acceptance for using media devices. Then it provides an instance of <code>Stream</code>, which carries media
        <strong>stream</strong> from computer device through the browser.
    </p>

    <p>The method <code>Stream.attachToElement</code> binds the <strong>stream</strong> to a DOM
        <code>&lt;video&gt;</code> element in order to display it in the web page.
    </p>

    <p class="text-center"><img src="assets/apirtc_createstream.svg" alt="image"></p>

    <pre class="border"><code>
        userAgent.createStream(&#123;audio: true,video: true&#125;).then(stream => &#123;stream.attachToElement(domElement)&#125;);
    </code></pre>

    <h2>Session</h2>

    <p>To use <strong>ApiRTC</strong>'s connected features, a <code>userAgent</code> must register to get a
        <strong>session</strong>. This can be done with or without authentication.
    </p>
    <!-- <p>TODO: lister les modes d'authentification, ou faire un lien vers un chapitre dédié</p> -->

    <p>Simply using <code>UserAgent.register</code> without authentication details registers a <code>userAgent</code> with
        <strong>ApiRTC</strong>'s servers without authentication.
    </p>

    <p class="text-center"><img src="assets/apirtc_useragent_register.svg" alt="image"></p>

    <pre class="border"><code>
        userAgent.register().then(session => &#123;...&#125;);
    </code></pre>

    <p>The <code>session</code> grants access to connected features such like <strong>conversations</strong> or
        <strong>conferences</strong>.
    </p>

    <h2>Conversation</h2>
    <p>An instance of <code>Conversation</code> is obtained from <code>Session.getOrCreateConversation</code>.
    </p>

    <p class="text-center"><img src="assets/apirtc_session_getOrCreateConversation.svg" alt="image"></p>

    <pre class="border"><code>
        conversation = session.getOrCreateConversation("MY_CONVERSATION");
    </code></pre>

    <!-- note : this is weird : conversation.join()-->
    <!-- could we make something easier to explain in the future : participant.join(conversationId) ? -->
    <p>Calling <code>Conversation.join</code> makes the <code>userAgent</code> who created this instance of
        <code>Conversation</code> (through it's <code>Session</code>) join the
        <strong>conversation</strong>.
        <!-- The <code>userAgent</code> then becomes a <strong>participant</strong>. -->
    </p>

    <p class="text-center"><img src="assets/apirtc_conversation_join.svg" alt="image"></p>
    <pre class="border"><code>
        conversation.join();
    </code></pre>

    <!-- TODO : this is weird again, now this is the conversation that actually wears the publish method -->
    <p>Once a <strong>conversation</strong> joined, a <code>userAgent</code> can publish a
        <strong>stream</strong> using <code>Conversation.publish</code> method :
    </p>

    <p class="text-center"><img src="assets/apirtc_conversation_publish.svg" alt="image"></p>

    <pre class="border"><code>
        conversation.publish(stream).then(stream => &#123;...&#125;);
    </code></pre>

    <!-- TODO : All that is weird and should be simplified -->
    <p>Subscribing to peer <strong>streams</strong> is done in two steps :</p>
    <ul>
        <li>
            Listening on <code>'streamListChanged'</code> event notifies of <strong>streams</strong> published to the
            <strong>conversation</strong>. Note that the data provided by the event is not a <code>Stream</code> but a
            <code></code>,
        </li>
        <li>Then method
            <code>conversation.subscribeToStream</code> makes this <strong>conversation</strong> subscribe to a
            <strong>stream</strong>.
        </li>
    </ul>
    <p>Once subscribed, listening on <code>'streamAdded'</code> notifies with a
        <code>Stream</code> instance which can be attached to web page for display.
    </p>

    <p class="text-center"><img src="assets/apirtc_conversation_subscribe.svg" alt="image"></p>

    <pre class="border"><code>
        conversation.on('streamListChanged', streamInfo => (&#123;
            if (streamInfo.listEventType === 'added') &#123;
                if (streamInfo.isRemote === true) &#123;
                    conversation.subscribeToStream(streamInfo.streamId);
                    ...
        &#125;);
        conversation.on('streamAdded', stream => (&#123;
            stream.attachToElement(domElement)
        &#125;);
    </code></pre>

    <p>At this stage, the application displays both yours and peers videos in the page !</p>


    <!-- TODO : provide a simple sample for each framework -->
    <p class="alert alert-info" role="alert">
        Please find full code of examples demonstrating theses concepts on <a href="https://dev.apirtc.com/tutorials" target="_blank">pure JS</a>, <a>Angular</a>, <a>React</a>.
    </p>



    <!-- TODO IDEA : -->
    <!-- Faire une documentation v5 qui correspondrait à ce que cela pourrait etre pour etre plus simple
    UserAgent -> Participant
    Session n'existe plus
    On crée une Conversation depuis un autre point d'entrée ?
    les events de converation sont revus pour ne pas avoir streamListChanged puis streamAdded, on aurait plutot participantJoined et sur participant récupéré streamAdded -->


    <!-- 
    <h3>Conference</h3>
    <p>La conférence est une conversation avec la possibilité d'avoir un modérateur qui doit être un utilisateur géré par ApiRTC.</p> -->


</div>