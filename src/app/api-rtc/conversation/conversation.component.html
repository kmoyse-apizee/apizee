<div class="container-fluid">
    <div class="container">
        <div *ngIf="!session">
            <div class="row">
                <div class="col">
                    <h1 class="text-center">Register as ...</h1>
                </div>
            </div>
            <div class="row">
                <div class="col"><button mat-raised-button color="primary" (click)="register()" title="Register as guest">Guest&nbsp;<i class="bi bi-box-arrow-in-right"></i></button></div>
                <div class="col">
                    <p class="text-center">Or</p>
                </div>
                <div class="col">
                    <app-login (credentials)="onCredentials($event)"></app-login>
                </div>
            </div>
        </div>
        <p *ngIf="session" class="alert alert-success" role="alert">Got Session <span *ngIf="jWT">jWT=<code>{{jWT}}</code></span></p>
        <p *ngIf="registrationError" class="alert alert-danger" role="alert">{{registrationError | json}}
        </p>
    </div>

    <div class="text-center">
        <form *ngIf="!conversation" [formGroup]="formGroup" (ngSubmit)="getOrcreateConversation()">
            <mat-form-field>
                <mat-label>Nom de la conversation</mat-label>
                <span matPrefix>{{convBaseUrl}}/</span>
                <input type="text" matInput placeholder="abcd" formControlName="convName">
                <!-- <mat-icon matSuffix>mode_edit</mat-icon> -->
            </mat-form-field>&nbsp;
            <button mat-raised-button color="primary" type="submit" [disabled]="!formGroup.valid||!session" title="Get Or Create Conversation"><i class="bi bi-box-arrow-in-right"></i></button>

        </form>

        <p *ngIf="conversation">{{convUrl}}&nbsp;<button mat-raised-button color="primary" [cdkCopyToClipboard]="convUrl"><i class="bi bi-share"></i></button>
            <button mat-raised-button color="primary" (click)="!joined?join():leave()" title="Join Conversation">{{!joined?'Join':'Leave'}}</button>
            <button mat-raised-button color="warn" (click)="destroy()">Destroy</button>
        </p>
    </div>

    <div class="card">
        <div class="card-body">

            <div id="videos" class="row row-cols-1 row-cols-sm-2">
                <div class="col mycard">
                    <div id="{{localStream?.stream.streamId}}" class="embed-responsive embed-responsive-4by3">
                        <video #localVideo muted autoplay playsinline></video>
                        <div class="mycard-text">
                            <!-- <h5 *ngIf="usernameFc.value">{{usernameFc.value}}</h5> -->
                            <form class="row row-cols-lg-auto g-3 align-items-center">
                                <div class="col-12">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Name</mat-label>
                                        <input matInput placeholder="Name" [formControl]="usernameFc">
                                        <mat-icon matSuffix>sentiment_very_satisfied</mat-icon>
                                        <mat-hint>Enter your name</mat-hint>
                                    </mat-form-field>
                                    <br>
                                    <mat-form-field appearance="fill">
                                        <mat-label>VideoIn</mat-label>
                                        <mat-select [formControl]="videoFc">
                                            <mat-option *ngFor="let device of videoDevices" [value]="device.id">
                                                {{device.label}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                    <mat-form-field appearance="fill">
                                        <mat-label>AudioIn</mat-label>
                                        <mat-select [formControl]="audioInFc">
                                            <mat-option *ngFor="let device of audioInDevices" [value]="device">
                                                {{device.label}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </form>
                            <app-audio-stats [stats]="localStream?.qosStat?.audioSent"></app-audio-stats>
                            <app-video-stats [stats]="localStream?.qosStat?.videoSent"></app-video-stats>
                        </div>
                        <div class="mycard-over">
                            <pre>
<code>streamId:{{localStream?.streamId}}</code>
<code>callId:{{localStream?.callId}}</code>
                            </pre>
                            <mat-icon *ngIf="localStream?.isSpeaking" matSuffix>record_voice_over</mat-icon>
                        </div>
                    </div>
                </div>

                <div class="col mycard" [hidden]="!screenSharingStream">
                    <div id="{{screenSharingStream?.streamId}}" class="embed-responsive embed-responsive-4by3">
                        <video #screenSharingVideo muted autoplay playsinline></video>
                    </div>
                </div>

                <div *ngFor="let stream of streams" class="col mycard">
                    <app-peer [conversation]="conversation" [stream]="stream"></app-peer>
                </div>
            </div>
        </div>
        <div class="card-footer">

            <button mat-raised-button color="primary" (click)="!localStream?createStream():destroyStream()" [disabled]="published">{{!localStream?'Create Stream':'Release Stream'}}</button>
            <!-- publishInPrgs -->
            <button mat-raised-button color="primary" (click)="!published?publish():unpublish()" [disabled]="!joined||publishInPrgs">{{!published?'Publish':'Unpublish'}}
                <span *ngIf="publishInPrgs" class="spinner-border text-light" role="status"></span></button> &nbsp;
            <button mat-raised-button color="primary" (click)="toggleScreenSharing()">{{screenSharingStream?'Unshare':'Share'}} Screen</button> &nbsp;
        </div>
    </div>

    <hr>
    <pre>
        <!-- <code>localPeerId is : {{localPeerId}}</code> -->
        <code>port {{window.location.port}}</code>
        <code>host {{window.location.host}}</code>
        <code>href {{window.location.href}}</code>
        <code>protocol {{window.location.protocol}}</code>
    </pre>


</div>